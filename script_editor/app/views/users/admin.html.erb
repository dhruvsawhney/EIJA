<!-- This file controls the view for user's profile pages.
It can be found at app/views/users/show.html.erb -->

<!-- This file's corresponding .scss file can be found at app/assets/stylesheets/users.scss -->
<%= javascript 'application' %>
<html>
<body style = "background-color: white; padding-top: 0px;">

<!-- This will display the name of the current user. -->
<h1><%= current_user.user_name%>'s Admin Page</h1>

<div class="container">
<span id="<%=current_user.id %>" class="adminId"></span>
  <div class="row" id="collapseExample">
    <div class="col-sm-3" id="adminButtons">

      <button id="groupBtn" type="button" class="btn btn-info">Add New Group</button>
        <!-- The Modal -->
        <div id="groupModal" class="modal">

          <!-- Modal content -->
          <div class="modal-content">
            <h4>Add New Group</h4>
            <button id="createGroup" type="button" class="btn btn-info">Create Group</button>
              <form id="groupForm" onsubmit="return false;">
                  <input type="text" id="userInput" />
              </form>
              <!-- Example here: https://datatables.net/examples/api/select_row.html -->
              <table id="allUsersGroups" class="table" style="width:100%">
                <thead>
                  <tr>
                    <th>Name</th>
                  </tr>
                </thead>
                <tbody>
                  <% @active_users.each do |usr| %>
                  <tr >
                    <td id="<%=usr[0]%>"><%=usr[1]%></td>
                  </tr>
                  <% end %>
                </tbody>
                <tfoot>
                  <tr>
                    <th>Name</th>
                  </tr>
                </tfoot>
            </table>
          </div>
        </div>

      <button id="adminBtn" type="button" class="btn btn-info">Add Admin</button>
      <!-- The Modal -->
        <div id="adminModal" class="modal">

          <!-- Modal content -->
          <div class="modal-content">
            <h4>Add Admin</h4>
            <button id="createAdmin" type="button" class="btn btn-info">Make Admin</button>
            <table id="allUsersAdmin" class="table" style="width:100%">
                <thead>
                  <tr>
                    <th>Name</th>
                  </tr>
                </thead>
                <tbody>
                  <% @active_users.each do |usr| %>
                  <tr id="<%=usr[0]%>">
                    <td><%=usr[1]%></td>
                  </tr>
                  <% end %>
                </tbody>
                <tfoot>
                  <tr>
                    <th>Name</th>
                  </tr>
                </tfoot>
            </table>
          </div>
        </div>
        <style>

        </style>

        <script>
            var users = [];
            $(document).ready(function() {
              $("#groupBtn").click(function(){
               $("#groupModal").modal('show');

               var table = $('#allUsersGroups').DataTable();
               $('#allUsersGroups tbody').on( 'click', 'tr', function () {
                     $(this).toggleClass('table-active');
                     $row = $(this).closest("tr"),       // Finds the closest row <tr>
                     $tds = $row.find("td");
                     user_id = $tds[0].id
                     if (users.includes(user_id)) {
                       users.pop(user_id)
                     } else {
                       users.push(user_id)
                     }
                     console.log(users)
               })
             })

              $("#adminBtn").click(function(){

               $("#adminModal").modal('show');
               var table = $('#allUsersAdmin').DataTable();

               $('#allUsersAdmin tbody').on( 'click', 'tr', function () {
                   $(this).toggleClass('table-active');
                   $row = $(this).closest("tr"),
                   $tds = $row.find("td");
                   user_id = $tds[0].id
                   if (users.includes(user_id)) {
                     users.pop(user_id)
                   } else {
                     users.push(user_id)
                   }
                   console.log(users)

           //         $.ajax({
           //           method: "POST",
           //           url: '/update/makeAdmin',
           //           data: {
           //               "meta": {
           //                 "usersID" : users
           //               }
           //           }
           //     } );
           //
           //    });
           //
              });
          })
        })

              // When the user clicks anywhere outside of the modal, close it
              var modal = document.getElementsByClassName("modal")[0];
              window.onclick = function(event) {
                if (event.target == modal) {
                  modal.style.display = "none";
                }
              }

              function showGroupInfo(groupNum) {
              // $.get('/scene_render/' + scenceId)//get HTML to insert
              //     .done(function(data)
              {
                // console.log(data);
                var group =$("#GroupWindow");
                group.html("");//clear previous data
              };
            };
              $("#createGroup").click(function(){
                sendGroup();
                console.log("clicked")
              });
              function sendGroup() {
                var name = $("#userInput")
                $.ajax({
                  method: "POST",
                  url: '/update/makeGroups',
                  data: {
                      "meta": {
                        "usersID" : users,
                        "name" : name
                      }
                  }
                });
              };
              function sendAdmin() {
                $.ajax({
                  method: "POST",
                  url: '/update/makeAdmin',
                  data: {
                      "meta": {
                        "usersID" : users
                      }
                  }
                })
              };
        </script>
    </div>

    <ul class="list-group">
      <h4>Groups</h4>
        <% groups = current_user.getGroups %>
        <% groups.uniq.each do |group| %>
           <a class="groupToggle" id=<%="group" + String(group[1])%> ><%=group[0]%></a>
        <% end %>
    </ul>

    <div class="col-sm-6" id="GroupWindow">
      <!-- this area displays the each group's info' -->
      <h4 style="margin-left: 10px" id="GroupName"> Group 1 :</h4>

    </div>

    <div class="group-info" id="groupInfo">

    </div>
</div>
</div>

</body>

</html>
