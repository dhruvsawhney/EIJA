<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body style = "background-color: #white">
    <p id="notice"></p>

<h2><%= @play.title %></h2>
<body class = "script-main">
    <% @acts.each do |act| %>
      <h3> Act <%= act.number %> </h3>
      <% rscenes = Scene.joins(:act).where(:act_id => act.id).order(:number) %>
      <% rscenes.each do |scene| %>
        <h4> Scene <%= scene.number %> </h4>
        <% rlines = Line.joins(:scene).where(:scene_id => scene.id).order(:number) %>
        <% rlines.each do |line| %>
          <% if line.isStage %>
              <p><button class ="word"><i><%= line.words %></i> </button></p>
          <% else %>
          <p><button id <%= line.id.to_s %> class ="word"> <strong><%= line.speaker %></strong> <%= line.number %> <%= line.words %> </button></p>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
</body>

<script>
    document.querySelector(".script-main").addEventListener("mousedown", drag, false);
    document.querySelector(".script-main").addEventListener("mouseover", doCut, false);
    document.querySelector(".script-main").addEventListener("mousedown", doCut, false);
    document.querySelector(".script-main").addEventListener("mouseup", lift, false);
    var mousedrag = false;
    var currId = 0;
    function drag(e)
    {
        mousedrag = true;
    }
    function lift(e)
    {
        mousedrag = false;
        currId = 0;
    }

    function literalCut(clickedItem,cut)
    {
        if(cut)
        {
            clickedItem.style.color = "#D3D3D3";
            clickedItem.style.textDecoration = "line-through";
            clickedItem.dataset.cut = "true";
        }
        else
        {
            clickedItem.style.color = "#000000";
            clickedItem.style.textDecoration = "none";
            clickedItem.dataset.cut = "false";   
        }
    }

    function checkWrap(clickedItem,cut)
    {
        var intId = parseInt(clickedItem.id)
        if(currId != 0)
        {
            //Wrap function goes here! Probably make it a helper and call it.
        }
        currId = intId;
    }

    // all words will need to be printed within the div class "script-main"
    function doCut(e) {
        var clickedItem = e.target;
        // stage
        if (clickedItem.getAttribute("class") == "stage") {
            if (clickedItem.tagName.toLowerCase() == "button") {
                if (mousedrag && !e.shiftKey) {
                    literalCut(clickedItem,true);
                    checkWrap(clickedItem,true);
                }
                else if(e.shiftKey && mousedrag) {
                    literalCut(clickedItem,false);
                }
            }
        }
        // line
        else if (clickedItem.getAttribute("class") == "word" || clickedItem.getAttribute("class") == "punc") {
            if (clickedItem.tagName.toLowerCase() == "button") {
                if (mousedrag && !e.shiftKey) {
                    console.log("What's up youtube");
                    literalCut(clickedItem,true);
                    checkWrap(clickedItem,true);
                }
                else if(e.shiftKey && mousedrag){
                    literalCut(clickedItem,false);
                    checkWrap(clickedItem,false);
                }
            }
        }
    };
</script>

</body></html>
